{
  "name": "Ticket Agent",
  "nodes": [
    {
      "parameters": {},
      "id": "cf20cb62-1944-49d2-bd73-751b8adba4c2",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "jsCode": "// Extraer datos del ticket\nconst ticketData = $input.item.json.ticketData || $input.item.json.query || '';\n\n// Parsear informaciÃ³n usando regex mejorado\nconst nameMatch = ticketData.match(/(?:nombre?|name)[:\\s]+([^,\\n]+)/i);\nconst emailMatch = ticketData.match(/(?:email|correo)[:\\s]+([^\\s,\\n]+)/i);\nconst descMatch = ticketData.match(/(?:descripci[oÃ³]n?|description)[:\\s]+(.+)/is);\nconst companyMatch = ticketData.match(/(?:empresa|company)[:\\s]+([^,\\n]+)/i);\n\nconst name = nameMatch ? nameMatch[1].trim() : 'No proporcionado';\nconst email = emailMatch ? emailMatch[1].trim() : 'No proporcionado';\nconst description = descMatch ? descMatch[1].trim() : ticketData;\nconst company = companyMatch ? companyMatch[1].trim() : 'No especificado';\n\nreturn {\n  json: {\n    name: name,\n    email: email,\n    description: description,\n    company: company,\n    ticketId: `AURIN-${Date.now()}`,\n    createdAt: new Date().toISOString()\n  }\n};"
      },
      "id": "8e4ce3a9-2ba6-411d-8455-4126b81f51ab",
      "name": "Parse Ticket Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        224,
        0
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "email-subject",
              "name": "emailSubject",
              "value": "=ğŸ« Nuevo Ticket de Soporte Aurin - {{ $json.name }}",
              "type": "string"
            },
            {
              "id": "email-body",
              "name": "emailBody",
              "value": "=Nuevo Ticket de Soporte - Chatbot Aurin\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“‹ INFORMACIÃ“N DEL TICKET\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nID del Ticket: {{ $json.ticketId }}\nFecha y Hora: {{ $json.createdAt }}\nOrigen: Chatbot Web (aurin.mx)\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ‘¤ INFORMACIÃ“N DEL CLIENTE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nNombre: {{ $json.name }}\nEmail: {{ $json.email }}\nEmpresa: {{ $json.company }}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“ DESCRIPCIÃ“N DE LA SOLICITUD\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n{{ $json.description }}\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâœ… ACCIONES SUGERIDAS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n1. Responder al cliente en: {{ $json.email }}\n2. Revisar el contexto completo de la conversaciÃ³n si estÃ¡ disponible\n3. Clasificar el tipo de consulta:\n   â–¡ Branding / Identidad Corporativa\n   â–¡ UX/UI / DiseÃ±o Digital\n   â–¡ DiseÃ±o GrÃ¡fico\n   â–¡ Estrategia Digital\n   â–¡ ConsultorÃ­a General\n   â–¡ Otra: _________________\n\n4. Asignar prioridad:\n   â–¡ Alta (responder en 2-4 horas)\n   â–¡ Media (responder en 24 horas)\n   â–¡ Baja (responder en 48 horas)\n\n5. Siguiente paso:\n   â–¡ Agendar consulta gratuita\n   â–¡ Enviar propuesta\n   â–¡ Solicitar mÃ¡s informaciÃ³n\n   â–¡ Referir a otro servicio\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“§ INFORMACIÃ“N DE CONTACTO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPara mÃ¡s informaciÃ³n:\nğŸ“§ hey@aurin.mx\nğŸŒ https://www.aurin.mx\nğŸ“ Aldea Creativa, MÃ©xico\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâœ¨ Este ticket fue generado automÃ¡ticamente por el chatbot de Aurin.\nğŸ¤– Sistema: n8n + OpenAI GPT-4o-mini\nğŸ”— Workflow ID: Ticket Agent\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "92c053b8-6908-40e2-a5ac-0734d4e55dda",
      "name": "Format Email",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        448,
        0
      ]
    },
    {
      "parameters": {
        "fromEmail": "karenrortizg@gmail.com",
        "toEmail": "karen@sodio.net",
        "subject": "={{ $json.emailSubject }}",
        "options": {}
      },
      "id": "e0a67073-09d4-4dfa-b611-bc126d7bafcd",
      "name": "Send Email to Karen",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [
        672,
        0
      ],
      "webhookId": "b21b66f2-7541-4eb6-a43f-30fa7844dd38"
    },
    {
      "parameters": {
        "jsCode": "// Formatear respuesta de Ã©xito para el usuario\nconst ticketData = $('Parse Ticket Data').item.json;\n\nreturn {\n  json: {\n    output: `âœ… **Perfecto, ${ticketData.name}!**\\n\\nHe creado un ticket de soporte y nuestro equipo te contactarÃ¡ a **${ticketData.email}** muy pronto.\\n\\n**ğŸ“‹ Detalles de tu ticket:**\\n- NÃºmero de ticket: **${ticketData.ticketId}**\\n- Estado: En proceso\\n- Tiempo estimado de respuesta: 24 horas\\n\\n**ğŸ“§ Email de contacto:** [hey@aurin.mx](mailto:hey@aurin.mx)\\n\\nNos pondremos en contacto contigo dentro de las prÃ³ximas 24 horas para atender tu solicitud personalmente.\\n\\nÂ¿Hay algo mÃ¡s en lo que pueda ayudarte mientras tanto?`,\n    success: true,\n    ticketId: ticketData.ticketId,\n    emailSent: true,\n    customerName: ticketData.name,\n    customerEmail: ticketData.email\n  }\n};"
      },
      "id": "8f962be7-2051-468e-9364-f232835f135d",
      "name": "Format Success Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        0
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Execute Workflow Trigger": {
      "main": [
        [
          {
            "node": "Parse Ticket Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Ticket Data": {
      "main": [
        [
          {
            "node": "Format Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Email": {
      "main": [
        [
          {
            "node": "Send Email to Karen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email to Karen": {
      "main": [
        [
          {
            "node": "Format Success Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cf9d8335-2ac2-49de-b869-082f035fbebb",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "473b8e2f44c2c249c630a674e0ffd242a718055278d7a389908825386c510f30"
  },
  "id": "xofJhOkiHd6ietuS",
  "tags": []
}