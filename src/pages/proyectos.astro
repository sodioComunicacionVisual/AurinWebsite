---
import Layout from '../layouts/Layout.astro';
import Header from '../components/ui/Header.astro';
import InteractiveBackground from '../components/ui/InteractiveBackground.astro';
import StickyFooter from '../components/ui/StickyFooter.astro';
import Introduction from '../components/sections/projects/Introduction.astro';
import ProjectCard from '../components/ui/ProjectCard.astro';
import PayloadProjectCard from '../components/ui/PayloadProjectCard.astro';
import MainCat from '../components/ui/MainCat.astro';
import { getLangFromUrl } from '../i18n/utils.js';
import { translations } from '../i18n/translations.js';
import { PayloadAPI, getImageUrl, type PayloadProject } from '../lib/payload';

// Detect current language
const currentLang = getLangFromUrl(Astro.url);
const t = translations[currentLang];

// Fetch projects from Payload CMS
let projects: PayloadProject[] = [];
let categories: any[] = [];

try {
  projects = await PayloadAPI.getProjects(currentLang);
  categories = await PayloadAPI.getCategories(currentLang);
  console.log('üì¶ Fetched projects from Payload:', projects.length);
} catch (error) {
  console.error('‚ùå Error fetching projects from Payload:', error);
  // Fallback to empty arrays - we'll show static content if needed
}

// SEO optimizado para LLMs y motores de b√∫squeda
const seoTitle = t.projects.seo.title;
const seoDescription = t.projects.seo.description;
const seoKeywords = t.projects.seo.keywords;

// Datos estructurados para SEO (Schema.org)
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": currentLang === 'es' ? "Portfolio de Proyectos - Aurin" : "Project Portfolio - Aurin",
  "description": seoDescription,
  "url": currentLang === 'es' ? "https://aurin.mx/proyectos" : "https://aurin.mx/en/projects",
  "inLanguage": currentLang === 'es' ? "es-MX" : "en-US",
  "mainEntity": {
    "@type": "Organization",
    "name": "Aurin",
    "url": "https://aurin.mx",
    "logo": "https://pub-d17bbbdbf8e348c5a57c8168ad69c92f.r2.dev/aurinWhiteLogo.webp",
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": currentLang === 'es' ? "Portfolio de Proyectos de Dise√±o" : "Design Project Portfolio",
      "itemListElement": [
        {
          "@type": "CreativeWork",
          "name": t.projects.projectTitles["proyecto-innovador-1"],
          "description": currentLang === 'es' ? "Proyecto de branding, UI/UX y desarrollo web" : "Branding, UI/UX and web development project",
          "creator": {
            "@type": "Organization",
            "name": "Aurin"
          },
          "keywords": [t.projects.projectTags["Branding"], t.projects.projectTags["UI/UX"], t.projects.projectTags["Web"]]
        },
        {
          "@type": "CreativeWork",
          "name": t.projects.projectTitles["transformacion-digital"],
          "description": currentLang === 'es' ? "Proyecto de desarrollo y estrategia digital" : "Development and digital strategy project",
          "creator": {
            "@type": "Organization",
            "name": "Aurin"
          },
          "keywords": [t.projects.projectTags["Desarrollo"], t.projects.projectTags["Estrategia"]]
        },
        {
          "@type": "CreativeWork",
          "name": t.projects.projectTitles["experiencia-usuario"],
          "description": currentLang === 'es' ? "Proyecto de investigaci√≥n UX y dise√±o" : "UX research and design project",
          "creator": {
            "@type": "Organization",
            "name": "Aurin"
          },
          "keywords": [t.projects.projectTags["UX Research"], t.projects.projectTags["Design"]]
        }
      ]
    }
  }
};

// Selectores CSS para contenido speakable (optimizaci√≥n de voz)
const speakable = [".projects-introduction", ".projects-strip", ".project-card"];

// Canonical URL based on language
const canonicalUrl = currentLang === 'es' ? "https://aurin.mx/proyectos" : "https://aurin.mx/en/projects";
---

<Layout 
  title={seoTitle}
  description={seoDescription}
  keywords={seoKeywords}
  structuredData={structuredData}
  speakable={speakable}
  canonical={canonicalUrl}
  ogImage="https://pub-d17bbbdbf8e348c5a57c8168ad69c92f.r2.dev/aurinWhiteLogo.webp"
>
  <InteractiveBackground />
  <Header />
  
  <main class="proyectos-page">
    <!-- Introduction Section -->
    <Introduction />
    
    <!-- Projects from Payload CMS -->
    {projects.length > 0 ? (
      <section class="projects-strip">
        <div class="strip-container">
          {projects.map((project) => (
            <PayloadProjectCard project={project} />
          ))}
        </div>
      </section>
    ) : (
      <!-- Fallback: Static projects if Payload is not available -->
      <>
        <section class="projects-strip">
          <div class="strip-container">
            <ProjectCard
              title={t.projects.projectTitles["proyecto-innovador-1"]}
              tags={[t.projects.projectTags["Branding"], t.projects.projectTags["UI/UX"], t.projects.projectTags["Web"]]}
              image="https://images.unsplash.com/photo-1558655146-9f40138edfeb?w=800&q=80"
              href="#"
            />
            <ProjectCard
              title={t.projects.projectTitles["transformacion-digital"]}
              tags={[t.projects.projectTags["Desarrollo"], t.projects.projectTags["Estrategia"]]}
              image="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&q=80"
              href="#"
            />
            <ProjectCard
              title={t.projects.projectTitles["experiencia-usuario"]}
              tags={[t.projects.projectTags["UX Research"], t.projects.projectTags["Design"]]}
              image="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80"
              href="#"
            />
          </div>
        </section>
        
        <section class="projects-strip">
          <div class="strip-container">
            <ProjectCard
              title={t.projects.projectTitles["identidad-visual"]}
              tags={[t.projects.projectTags["Branding"], t.projects.projectTags["Dise√±o Gr√°fico"]]}
              image="https://images.unsplash.com/photo-1561070791-2526d30994b5?w=800&q=80"
              href="#"
            />
            <ProjectCard
              title={t.projects.projectTitles["plataforma-digital"]}
              tags={[t.projects.projectTags["Web App"], t.projects.projectTags["Mobile"]]}
              image="https://images.unsplash.com/photo-1551434678-e076c223a692?w=800&q=80"
              href="#"
            />
            <ProjectCard
              title={t.projects.projectTitles["estrategia-marca"]}
              tags={[t.projects.projectTags["Marketing"], t.projects.projectTags["Branding"]]}
              image="https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&q=80"
              href="#"
            />
          </div>
        </section>
      </>
    )}
    
    <!-- Call to Action -->
    <MainCat />
  </main>
  
  <StickyFooter />
</Layout>

<style>
  .proyectos-page {
    width: 100%;
    min-height: 100vh;
    padding-top: 80px;
  }
  
  /* Projects Strip */
  .projects-strip {
    width: 100%;
    padding: 60px 0;
  }
  
  .strip-container {
    max-width: var(--maxWidth);
    margin: 0 auto;
    padding: 0 100px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
  }
  
  /* Responsive Design */
  @media (max-width: 1200px) {
    .strip-container {
      padding: 0 60px;
      gap: 30px;
    }
  }
  
  @media (max-width: 968px) {
    .strip-container {
      grid-template-columns: repeat(2, 1fr);
      padding: 0 40px;
    }
    
    .projects-strip {
      padding: 40px 0;
    }
  }
  
  @media (max-width: 768px) {
    .proyectos-page {
      padding-top: 60px;
    }
    
    .strip-container {
      padding: 0 30px;
      gap: 24px;
    }
  }
  
  @media (max-width: 640px) {
    .strip-container {
      grid-template-columns: 1fr;
      padding: 0 20px;
    }
    
    .projects-strip {
      padding: 30px 0;
    }
  }
</style>
